package broker.three.server;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.Socket;
import java.sql.SQLException;

import broker.three.exception.InvalidTransactionException;
import broker.three.exception.RecordNotFoundException;
import broker.three.shares.Command;
import broker.three.shares.Result;

public class JuryThread extends Thread {
	private Socket s;
	private Database db;
	private Command cmd;
	private ObjectInputStream ois;
	private ObjectOutputStream oos;
	
	public JuryThread(Socket s, Database db) {
		try {
			this.s = s;
			this.db = db;
			ois = new ObjectInputStream(s.getInputStream());
			oos = new ObjectOutputStream(s.getOutputStream());
		} catch(Exception e) {
			System.out.println(e.getMessage());
		}
	}

	public void run() {
		System.out.println("Jury Run...");
		while(true) {
			try {
				cmd = (Command)ois.readObject();
				int value = cmd.getCommanValue();
				String[] args = cmd.getArgs();
				Result r = cmd.getResults();
				switch(value) {
					case Command.GET_ALL_CUSTOMER :{
						try {
							r.add(db.getAllCustomers());
							r.setStatus(0);
						} catch(Exception e) {
							
						}
						break;
					}
					case Command.BUY_SHARES : {
						try {
							db.buyShares(args[0], args[1], Integer.parseInt(args[2]));
							r.setStatus(0);
						} catch(Exception e) {
							
						}
						break;
					}
					case Command.SELL_SHARES : {
						try {
							db.sellShares(args[0], args[1], Integer.parseInt(args[2]));
							r.setStatus(0);

						} catch (RecordNotFoundException e) {
							r.setStatus(-1);
						} catch (InvalidTransactionException e) {
							r.setStatus(-3);
						} catch (Exception e) {
							System.out.println(e.getMessage());
						}
					}
					case Command.GET_ALL_STOCK : {
						try {
							r.add(db.getAllStocks());
							r.setStatus(0);
						
						} catch(Exception e) {}
						break;
					}
					case Command.GET_STOCK_PRICE : {
						try {
							float price = db.getStockPrice(args[0]);
						} catch (RecordNotFoundException e) {
							System.out.println("No Such Record Found !");
						}
						break;
					}
					case Command.GET_CUSTOMER : {
						try {
							
						} catch (Exception e) { 
							
						}
					}
					
				}
			} catch (ClassNotFoundException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	}
}
